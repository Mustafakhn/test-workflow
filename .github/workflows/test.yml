name: test-workflow

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]


jobs:
  test-after-deploying-to-default-with-curl:
    
    runs-on: ubuntu-latest
    
    steps:
    - name: health-check-with-curl
      id: test
      uses: Mustafakhn/health-check-action@v2
      with:
          website_url: https://abc-full-cicd.uc.r.appspot.com/
          version_name: version
          method: curl
          timeout: 5
          
      if: faliure()
    - run: echo "exit_stataus=$?" >> $GITHUB_OUTPUT
    
          
#   notification:
#     runs-on: ubuntu-latest
#     needs: [ test-after-deploying-to-default-with-curl ]
#     if: failure()
#     steps:
#     - name: failure-message
#       run: echo "failure"

      
    - name: health-check-with-wget
#       if: faliure()
      run: echo ${{ steps.test.outputs.exit_status }}
#       uses: Mustafakhn/health-check-action@main
#       with:
#           website_url: https://full-cicd.uc.r.appspot.com/
#           version_name: version
#           method: wget
    - run: wget https://full-cicd.uc.r.appspot.com/ && echo $?
          
  notification-success:
    runs-on: ubuntu-latest
    needs: [ test-after-deploying-to-default-with-curl ]
    if: success()
    steps:
    - name: success-message
      
      run: echo "success"
  
  notification-failure:
    runs-on: ubuntu-latest
    needs: [ test-after-deploying-to-default-with-curl ]
    if: failure()
    
    steps:
    - name: failure-message
      if: failure()
      run: echo "failure"
